(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-27",headers:{authorization:"4d005c46-ea96-417e-ac32-9143ae88b3d7","Content-Type":"application/json"}};function t(e,t,o,n,r,c){var u=o.cloneNode(!0),a=u.querySelector(".places__item"),i=a.querySelector(".card__title"),s=a.querySelector(".card__image"),l=a.querySelector(".card__delete-button"),d=a.querySelector(".card__like-counter");l.style.display="none";var p=a.querySelector(".card__like-button");return e.owner._id==t._id&&(l.style.display="flex",l.addEventListener("click",(function(){r(a,e._id)}))),e.likes.forEach((function(e){e._id!=t._id||p.classList.add("card__like-button_is-active")})),d.textContent=e.likes.length,i.textContent=e.name,s.setAttribute("src",e.link),s.setAttribute("alt",e.name),p.addEventListener("click",(function(t){n(t,d,e._id)})),s.addEventListener("click",(function(){c(e)})),u}function o(t,o,n){var r,c=!1;t.target.classList.forEach((function(e){"card__like-button_is-active"!=e||(c=!0)})),c?(r=n,fetch("".concat(e.baseUrl,"/cards/likes/").concat(r),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){t.target.classList.remove("card__like-button_is-active"),o.textContent=e.likes.length})):function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(n).then((function(e){t.target.classList.add("card__like-button_is-active"),o.textContent=e.likes.length}))}function n(t,o){var n;(n=o,fetch("".concat(e.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then(t.remove())}function r(e){e.classList.add("popup_is-opened")}function c(){document.querySelector(".popup_is-opened").classList.remove("popup_is-opened")}var u,a=function(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(o.inactiveButtonClass):t.classList.add(o.inactiveButtonClass)},i=function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector));console.log(e);var n=Array.from(e.querySelectorAll("."+t.errorClass));console.log(n,t.errorClass),o.forEach((function(e){e.classList.remove(t.inputErrorClass),e.value=""})),n.forEach((function(e){e.classList.remove(t.errorClass),e.textContent=""})),e.querySelector(t.submitButtonSelector).classList.add("popup__button_disabled")},s={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},l=document.querySelector("#card-template").content,d=document.querySelector(".places__list"),p=document.querySelector(".profile__add-button"),_=document.querySelector(".popup_type_new-card"),v=document.querySelector(".profile__edit-button"),m=document.querySelector(".popup_type_edit"),f=document.querySelector(".profile__title"),y=document.querySelector(".profile__description"),S=document.querySelector(".profile__image"),h=document.querySelector(".popup_type_edit-avatar"),k=document.querySelector(".popup__input_type_avatar-url"),q=document.querySelector(".popup_type_image"),E=document.querySelector(".popup__input_type_name"),L=document.querySelector(".popup__input_type_description"),b=q.querySelector(".popup__image"),C=q.querySelector(".popup__caption"),g=_.querySelector(".popup__form"),x=m.querySelector(".popup__form"),j=h.querySelector(".popup__form");function w(){var e=document.querySelector(".popup_is-opened"),t=e.querySelector(s.formSelector);i(t,s),c(),e.querySelector(".popup__close").removeEventListener("click",w),document.removeEventListener("keydown",A),e.removeEventListener("click",T)}function P(){var e=document.querySelector(".popup_is-opened");c(),e.querySelector(".popup__close").removeEventListener("click",P),document.removeEventListener("keydown",U),e.removeEventListener("click",B)}function A(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened"),o=t.querySelector(s.formSelector);i(o,s),c(),t.querySelector(".popup__close").removeEventListener("click",w),document.removeEventListener("keydown",A),t.removeEventListener("click",T)}}function U(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");c(),t.querySelector(".popup__close").removeEventListener("click",P),document.removeEventListener("keydown",U),t.removeEventListener("click",B)}}function T(e){if(e.currentTarget===e.target){var t=document.querySelector(".popup_is-opened"),o=t.querySelector(s.formSelector);i(o,s),c(),t.querySelector(".popup__close").removeEventListener("click",w),document.removeEventListener("keydown",A),t.removeEventListener("click",T)}}function B(e){if(e.currentTarget===e.target){var t=document.querySelector(".popup_is-opened");c(),t.querySelector(".popup__close").removeEventListener("click",P),document.removeEventListener("keydown",U),t.removeEventListener("click",B)}}function D(e){e.classList.add("popup_is-animated")}function M(e){r(q),q.querySelector(".popup__close").addEventListener("click",P),document.addEventListener("keydown",U),q.addEventListener("click",B),b.src=e.link,b.alt=e.name,C.textContent=e.name}function N(t){t.preventDefault();var o,n=m.querySelector(".popup__button");n.textContent="Сохранение...",f.textContent=E.value,y.textContent=L.value,(o={name:E.value,about:L.value},fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:o.name,about:o.about})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){c();var t=_.querySelector(s.formSelector);i(t,s),u=e,f.textContent=e.name,y.textContent=e.about,n.textContent="Сохранить"}))}function O(t){t.preventDefault();var o,n=h.querySelector(".popup__button");n.textContent="Сохранение...",(o=k.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){c();var t=h.querySelector(s.formSelector);i(t,s),u=e,console.log(e),S.style.backgroundImage="url("+e.avatar+")",n.textContent="Сохранить"}))}function J(r){var a,p=_.querySelector(".popup__button");p.textContent="Сохранение...",(a=function(e,t){var o=t.querySelector(".popup__input_type_card-name"),n=t.querySelector(".popup__input_type_url");e.preventDefault();var r={name:o.value,link:n.value};return e.target.reset(),r}(r,_),fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:a.name,link:a.link})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){d.insertBefore(t(e,u,l,o,n,M),d.firstChild),p.textContent="Сохранить",c();var r=_.querySelector(s.formSelector);i(r,s)}))}D(_),D(m),D(q),D(h),Promise.all([fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))]).then((function(e){(function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);a(o,n,t),o.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,o){t.validity.valid?function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""}(e,t,o):function(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(e,t,t.validity.patternMismatch&&t.dataset.errorMessage?t.dataset.errorMessage:t.validationMessage,o)}(e,r,t),a(o,n,t)}))}))}(t,e)}))})(s),u=e[0],f.textContent=u.name,y.textContent=u.about,S.style.backgroundImage="url("+u.avatar+")",e[1].forEach((function(e){d.append(t(e,u,l,o,n,M))})),g.addEventListener("submit",J),x.addEventListener("submit",N),j.addEventListener("submit",O),p.addEventListener("click",(function(){r(_),_.querySelector(".popup__close").addEventListener("click",w),document.addEventListener("keydown",A),_.addEventListener("click",T)})),v.addEventListener("click",(function(){E.value=u.name,L.value=u.about,r(m),m.querySelector(".popup__close").addEventListener("click",w),document.addEventListener("keydown",A),m.addEventListener("click",T)})),S.addEventListener("click",(function(){k.value=u.avatar,r(h),h.querySelector(".popup__close").addEventListener("click",w),document.addEventListener("keydown",A),h.addEventListener("click",T)}))}))})();